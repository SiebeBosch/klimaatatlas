{
	"datasets":[
		{
			"_comment":"this attribute describes the water area polygons",
			"id":"watervlakken",
			"data_type":"polygons",
			"storage_type":"geojson",
			"path":"c:\\GITHUB\\klimaatatlas\\rekenregels\\Watervlakken Plus.json",
			"fields":[
				{"fieldtype":"id", "fieldname":"CODE"}, 
			]			
		},
		{
			"_comment":"this attribute describes where the water quality results as computed with SOBEK can be found",
			"id":"sobek_results",
			"data_type":"timeseries",
			"storage_type":"SQLITE",
			"path":"c:\\GITHUB\\klimaatatlas\\rekenregels\\database.db",
			"tablename":"WQTIMESERIES",
			"fields":[
				{"fieldtype":"origin", "fieldname":"DATASOURCE", "selection":["SOBEK"]}, 
				{"fieldtype":"scenario", "fieldname":"SCENARIO", "selection":["2014", "2085"]}, 
				{"fieldtype":"parameter_name", "fieldname":"SUBSTANCE", "selection":["OXY", "Cl", "Nt", "Pt", "ModTemp", "ResTim"]}, 
				{"fieldtype":"id", "fieldname":"LOCATIONID"}, 
				{"fieldtype":"date", "fieldname":"DATEANDTIME"}, 
				{"fieldtype":"parameter_value", "fieldname":"DATAVALUE"},
				{"fieldtype":"x", "fieldname":"X"}, 
				{"fieldtype":"y", "fieldname":"Y"}
			]			
		},
		{
			"_comment":"this attribute describes where the derived timeseries as produced by the software should be written to",
			"id":"derived_series",
			"data_type":"timeseries",
			"storage_type":"SQLITE",
			"path":"c:\\GITHUB\\klimaatatlas\\rekenregels\\database.db",
			"tablename":"WQDERIVEDSERIES",
			"fields":[
				{"fieldtype":"date", "fieldname":"DATEANDTIME"}, 
				{"fieldtype":"scenario", "fieldname":"SCENARIO"}, 
				{"fieldtype":"parameter_name", "fieldname":"SUBSTANCE"}, 
				{"fieldtype":"id", "fieldname":"LOCATIONID"}, 
				{"fieldtype":"parameter_value", "fieldname":"DATAVALUE"}
			]
		},
		{
			"_comment":"this attribute describes where the water quality indicator values as produced by the software should be written to",
			"id":"indicators",
			"data_type":"scalar",
			"storage_type":"SQLITE",
			"path":"c:\\GITHUB\\klimaatatlas\\rekenregels\\database.db",
			"tablename":"INDICATORS",
			"fields":[
				{"fieldtype":"scenario", "fieldname":"SCENARIO"}, 
				{"fieldtype":"parameter_name", "fieldname":"INDICATOR"}, 
				{"fieldtype":"id", "fieldname":"LOCATIONID"}, 
				{"fieldtype":"parameter_value", "fieldname":"DATAVALUE"}
			]
		}
	],
	"rules":[
		{
			"name":"vermestende stoffen",
			"execute":false,
			"_comment":"this rule lets us construct a composite timeseries of nutrient values in the water by weigthing the concentration of phosphate ten times that of ammonia. In 'equation' values that should be taken from the database are surrounded by [].  In 'equation' the text surrounded by [ and ] refers to a value from the field parameter_name in the dataset.",
			"operation_type":"timeseries_transformation",
			"input":{"dataset":"sobek_results"},
			"equation":"[Nt]/10+[Pt]",
			"output":{"dataset":"derived_series","parameter_name":"vermestende_stoffen"}
		},
		{
			"name":"eutroof",
			"execute":false,
			"_comment":"this rule identifies the moments where the composite concentration of nutrients exceeds a value of 6 and tells us where to write the resulting timeseries to. I the criterium is met, a value of 1 should be written; if not, a value of 0 should be written.",
			"operation_type":"timeseries_filter",
			"input":{"dataset":"derived_series", "parameter_name":"vermestende_stoffen"},
			"filter":{
				"type":"exceeds_threshold", 
				"args":[5],
				"value_true":1,
				"value_false":0
			},
			"output":{"dataset":"derived_series", "parameter_name":"eutroof"}
		},
		{
			"name":"warm",
			"execute":false,
			"_comment":"this rule tells us to create a moving window of 12 hours and herewith identify all timespans where the parameter value ModTemp exceeds a value of 19 for the entire window. It also tells us where to write the resulting timeseries to. If the criterium is met, the value 1 should be written to the database. Else the value of 0 should be written.",
			"operation_type":"timeseries_filter",
			"input":{"dataset":"sobek_results","parameter_name":"ModTemp"},
			"filter":{
				"type":"consecutive_hours_exceeding_threshold", 
				"args":[12,19],
				"value_true":1,
				"value_false":0
			},
			"output":{"dataset":"derived_series", "parameter_name":"warm"}
		},
		{
			"name":"warm en eutroof",
			"execute":false,
			"_comment":"this rule adds up the results of two previous rules viz. 'warm' + 'eutroof'. In 'equation' the text surrounded by [ and ] refers to a value from the field parameter_name in the dataset.",
			"operation_type":"timeseries_transformation",
			"input":{"dataset":"derived_series"},
			"equation":"[warm]+[eutroof]",
			"output":{"dataset":"derived_series", "parameter_name":"warm_en_eutroof"}
		},
		{
			"name":"eutrofieringshotspots",
			"execute":false,
			"_comment":"this rule classifies the result of our previous rule, viz. 'warm en eutroof'. It calculates the total number of hours per year in which the value from 'warm en eutroof' equals 1. The result should be classified and written to the parameter 'eutrofiering_hotspot'",
			"operation_type":"timeseries_classification",
			"input":{"dataset":"derived_series", "parameter_name":"warm_en_eutroof"},
			"filter":{
				"type":"count_hours_per_year",
				"value":1,
				"classes":[
					{"from":0,"to":1000,"rating":1},
					{"from":1000,"to":2000,"rating":3},
					{"from":2000,"to":3000,"rating":5},
					{"from":3000,"to":5000,"rating":8},
					{"from":5000,"to":"inf","rating":10}
				]
			},
			"output":{"dataset":"indicators", "parameter_name":"eutrofiering_hotspot"}
		},
		{
			"name":"watervlakken",
			"execute":true,
			"_comment":"We need to project our results on the map. For this we carry out a spatial join with the 'watervlakkenkaart'",
			"operation_type":"spatial_join",
			"input":{"dataset":"derived_series", "parameter_name":"warm_en_eutroof"},
			"filter":{
				"type":"count_hours_per_year",
				"value":1,
				"classes":[
					{"from":0,"to":1000,"rating":1},
					{"from":1000,"to":2000,"rating":3},
					{"from":2000,"to":3000,"rating":5},
					{"from":3000,"to":5000,"rating":8},
					{"from":5000,"to":"inf","rating":10}
				]
			},
			"output":{"dataset":"indicators", "parameter_name":"eutrofiering_hotspot"}
		},
	]
}